<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web网盘</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <h1>☁️ Web网盘</h1>
                <p>安全、便捷的文件管理平台</p>
            </div>
            <div class="header-right">
                <div class="server-info" id="serverInfo">
                    <span>🌐 内网地址: 加载中...</span>
                </div>
                <div class="storage-info" id="storageInfo">
                    <span>📦 存储空间: 加载中...</span>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="toolbar">
                <button class="btn btn-success" onclick="showUploadModal()">
                    📤 上传文件
                </button>
                <button class="btn" onclick="showCreateFolderModal()">
                    📁 新建文件夹
                </button>
                <button class="btn btn-secondary" onclick="loadTree()">
                    🔄 刷新
                </button>
                <div class="search-box">
                    <input type="text" id="searchInput" class="search-input" placeholder="搜索文件或文件夹...">
                    <div class="search-icon">🔍</div>
                    <div class="search-results" id="searchResults"></div>
                </div>
                <div class="current-folder" id="currentFolder" style="display: none;">
                    当前文件夹: <span id="currentFolderPath">/</span>
                </div>
            </div>

            <div id="alertContainer"></div>

            <div class="file-browser" id="fileBrowser">
                <div class="drop-zone" id="rootDropZone" style="display: none;">
                    📁 拖放到此处移动到根目录
                </div>
                <div class="loading">
                    <div class="spinner"></div>
                    加载中...
                </div>
            </div>
        </div>
    </div>

    <!-- 上传文件模态框 -->
    <div class="modal" id="uploadModal">
        <div class="modal-content">
            <div class="modal-header">上传文件</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">选择文件</label>
                    <input type="file" id="fileInput" class="form-input" multiple>
                </div>
                <div class="form-group">
                    <label class="form-label">上传到文件夹</label>
                    <select id="uploadFolderSelect" class="form-select">
                        <option value="">根目录</option>
                    </select>
                </div>
                <div class="upload-progress" id="uploadProgress">
                    <div class="progress-text" id="progressText">准备上传...</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('uploadModal')">取消</button>
                <button class="btn btn-success" onclick="startUpload()">上传</button>
            </div>
        </div>
    </div>

    <!-- 创建文件夹模态框 -->
    <div class="modal" id="createFolderModal">
        <div class="modal-content">
            <div class="modal-header">创建文件夹</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">文件夹名称</label>
                    <input type="text" id="folderNameInput" class="form-input" placeholder="请输入文件夹名称">
                </div>
                <div class="form-group">
                    <label class="form-label">创建位置</label>
                    <select id="createFolderSelect" class="form-select">
                        <option value="">根目录</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('createFolderModal')">取消</button>
                <button class="btn" onclick="createFolder()">创建</button>
            </div>
        </div>
    </div>

    <!-- 移动文件模态框 -->
    <div class="modal" id="moveModal">
        <div class="modal-content">
            <div class="modal-header">移动文件/文件夹</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">移动到</label>
                    <select id="moveTargetSelect" class="form-select">
                        <option value="">根目录</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('moveModal')">取消</button>
                <button class="btn" onclick="moveItem()">移动</button>
            </div>
        </div>
    </div>

    <!-- 重命名模态框 -->
    <div class="modal" id="renameModal">
        <div class="modal-content">
            <div class="modal-header">重命名</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" id="renameLabel">新名称</label>
                    <input type="text" id="renameInput" class="form-input" placeholder="请输入新名称">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('renameModal')">取消</button>
                <button class="btn" onclick="renameItem()">确定</button>
            </div>
        </div>
    </div>

    <!-- 创建文件模态框 -->
    <div class="modal" id="createFileModal">
        <div class="modal-content">
            <div class="modal-header">创建文件</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">文件名称</label>
                    <input type="text" id="fileNameInput" class="form-input" placeholder="请输入文件名称">
                </div>
                <div class="form-group">
                    <label class="form-label">创建位置</label>
                    <select id="createFileFolderSelect" class="form-select">
                        <option value="">根目录</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('createFileModal')">取消</button>
                <button class="btn" onclick="createFile()">创建</button>
            </div>
        </div>
    </div>

    <!-- 右键菜单 -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" id="menuCreateFile" onclick="contextMenuCreateFile()">
            <span>📄</span>
            <span>新建文件</span>
        </div>
        <div class="context-menu-item" id="menuCreateFolder" onclick="contextMenuCreateFolder()">
            <span>📁</span>
            <span>新建文件夹</span>
        </div>
        <div class="context-menu-divider" id="menuDivider1"></div>
        <div class="context-menu-item" id="menuRename" onclick="contextMenuRename()">
            <span>✏️</span>
            <span>重命名</span>
        </div>
        <div class="context-menu-item" id="menuMove" onclick="contextMenuMove()">
            <span>📦</span>
            <span>移动</span>
        </div>
        <div class="context-menu-divider" id="menuDivider2"></div>
        <div class="context-menu-item" id="menuRestore" onclick="contextMenuRestore()">
            <span>♻️</span>
            <span>恢复</span>
        </div>
        <div class="context-menu-item" id="menuRestoreAll" onclick="contextMenuRestoreAll()">
            <span>🔄</span>
            <span>一键恢复</span>
        </div>
        <div class="context-menu-item" id="menuEmptyTrash" onclick="contextMenuEmptyTrash()">
            <span>🗑️</span>
            <span>清空回收站</span>
        </div>
        <div class="context-menu-item danger" id="menuDelete" onclick="contextMenuDelete()">
            <span>🗑️</span>
            <span>删除</span>
        </div>
        <div class="context-menu-item danger" id="menuPermanentDelete" onclick="contextMenuPermanentDelete()">
            <span>⚠️</span>
            <span>永久删除</span>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>


